apiVersion: v1
kind: Secret
metadata:
  name: postiz-secret
  namespace: postiz
type: Opaque
stringData:
  JWT_SECRET: "your-random-jwt-secret-change-this-to-something-secure-and-unique"
  REDIS_URL: "redis://postiz-redis:6379"
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: postiz-db-secret
  namespace: postiz
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: postiz-secret-store
    kind: ClusterSecretStore
  target:
    name: postiz-db-credentials
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        POSTGRES_USER: "{{ .POSTGRES_USER }}"
        POSTGRES_PASSWORD: "{{ .POSTGRES_PASSWORD }}"
        DATABASE_URL: "postgres://{{ .POSTGRES_USER }}:{{ .POSTGRES_PASSWORD }}@postiz-db:5432/postiz"
  data:
    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        key: postiz.postiz-db.credentials.postgresql.acid.zalan.do
        property: password
    - secretKey: POSTGRES_USER
      remoteRef:
        key: postiz.postiz-db.credentials.postgresql.acid.zalan.do
        property: username
---
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: postiz-secret-store
spec:
  provider:
    kubernetes:
      remoteNamespace: postiz
      server:
        url: "https://kubernetes.default.svc:443"
        caProvider:
          type: ConfigMap
          name: kube-root-ca.crt
          namespace: kube-system
          key: ca.crt
      auth:
        serviceAccount:
          name: eso-external-secrets
          namespace: eso
