apiVersion: v1
kind: Secret
metadata:
  name: postiz-secret
  namespace: postiz
type: Opaque
stringData:
  JWT_SECRET: "your-random-jwt-secret-change-this-to-something-secure-and-unique"
  DATABASE_URL: "postgresql://postiz:$(POSTGRES_PASSWORD)@postiz-db:5432/postiz"
  REDIS_URL: "redis://postiz-redis:6379"
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: postiz-db-secret
  namespace: postiz
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: postiz-secret-store
    kind: ClusterSecretStore
  target:
    name: postiz-db-credentials
    creationPolicy: Owner
  data:
    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        key: postiz.postiz-db.credentials.postgresql.acid.zalan.do
        property: password
    - secretKey: POSTGRES_USER
      remoteRef:
        key: postiz.postiz-db.credentials.postgresql.acid.zalan.do
        property: username
---
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: postiz-secret-store
spec:
  provider:
    kubernetes:
      # with some authentication
      remoteNamespace: postiz
      auth:
        serviceAccount:
          name: "external-secrets"
          namespace: "external-secrets-system"
      server:
        caProvider:
          type: "ConfigMap"
          name: "kube-root-ca.crt"
          key: "ca.crt"
