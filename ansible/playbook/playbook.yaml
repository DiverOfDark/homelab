---
- name: System setups
  hosts: working_hosts
  gather_facts: true
  become: true
  roles:
     - role: system
       tags: ['system']
     - role: swap
       tags: ['swap']
     - role: seedbox-mount
       tags: ['seedbox-mount']
     - role: keepalived
       tags: ['keepalived']
     - role: dnsmasq
       tags: ['dnsmasq']

  handlers:
     - import_tasks: ../roles/dnsmasq/handlers/main.yml
     - import_tasks: ../roles/keepalived/handlers/main.yml
     - import_tasks: ../roles/seedbox-mount/handlers/main.yml

- name: Kubernets cluster - node by node
  hosts: working_hosts
  gather_facts: false
  become: true
  serial: 1
  roles:
     - role: k3s
       tags: ['k3s']
     - role: etcd
       tags: ['etcd']
  handlers:
     - import_tasks: ../roles/k3s/handlers/main.yml
