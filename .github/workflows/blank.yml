name: CI

on:
  push:
    branches: [ "master" ]

  workflow_dispatch:

jobs:
  build:
    runs-on: github-runner-instance
    container: alpine
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.14'
      - name: Install Ansible
        run: |
          cd ansible
          
          python3 -m venv .venv
          source .venv/bin/activate
          pip install -r requirements.txt
          
          export ANSIBLE_CONFIG=ansible.cfg
          
          echo "Checking Ansible syntax..."
          ansible-playbook playbook.yaml -i inventory.yaml --syntax-check
          
          echo "Running Ansible playbook in check mode..."
          echo ${VAULT_PASSWORD} | setsid ansible-playbook playbook.yaml -i inventory.yaml --ask-vault-password --check --diff